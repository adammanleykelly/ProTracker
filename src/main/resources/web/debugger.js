"use strict";var FontInspector=function(){function e(){for(var a=document.querySelectorAll("div["+d+"]"),b=0,c=a.length;b<c;++b){a[b].className=""}}function f(){for(var a=document.querySelectorAll("div["+d+"]"),b=0,c=a.length;b<c;++b){a[b].className="debuggerHideText"}}function g(a,b){for(var c=document.querySelectorAll("div["+d+"="+a+"]"),e=0,f=c.length;e<f;++e){c[e].className=b?"debuggerShowText":"debuggerHideText"}}function h(a){if(a.target.dataset.fontName&&"DIV"===a.target.tagName.toUpperCase())for(var b=a.target.dataset.fontName,c=document.getElementsByTagName("input"),d=0;d<c.length;++d){var e=c[d];e.dataset.fontName===b&&(e.checked=!e.checked,g(b,e.checked),e.scrollIntoView())}}var b,c=!1,d="data-font-name";return{id:"FontInspector",name:"Font Inspector",panel:null,manager:null,init:function(c){var d=this.panel;d.setAttribute("style","padding: 5px;");var e=document.createElement("button");e.addEventListener("click",f),e.textContent="Refresh",d.appendChild(e),b=document.createElement("div"),d.appendChild(b)},cleanup:function(){b.textContent=""},enabled:!1,get active(){return c},set active(a){c=a,c?(document.body.addEventListener("click",h,!0),f()):(document.body.removeEventListener("click",h,!0),e())},fontAdded:function(c,d){function e(a,b){for(var c=document.createElement("table"),d=0;d<b.length;d++){var e=document.createElement("tr"),f=document.createElement("td");f.textContent=b[d],e.appendChild(f);var g=document.createElement("td");g.textContent=a[b[d]].toString(),e.appendChild(g),c.appendChild(e)}return c}var h=e(c,["name","type"]),i=c.loadedName,j=document.createElement("div"),k=document.createElement("span");k.textContent=i;var l=document.createElement("a");d?(d=/url\(['"]?([^\)"']+)/.exec(d),l.href=d[1]):c.data&&(d=URL.createObjectURL(new Blob([c.data],{type:c.mimeType})),l.href=d),l.textContent="Download";var m=document.createElement("a");m.href="",m.textContent="Log",m.addEventListener("click",function(a){a.preventDefault(),console.log(c)});var n=document.createElement("input");n.setAttribute("type","checkbox"),n.dataset.fontName=i,n.addEventListener("click",function(a,b){return function(){g(b,a.checked)}}(n,i)),j.appendChild(n),j.appendChild(k),j.appendChild(document.createTextNode(" ")),j.appendChild(l),j.appendChild(document.createTextNode(" ")),j.appendChild(m),j.appendChild(h),b.appendChild(j),setTimeout(function(){this.active&&f()}.bind(this),2e3)}}}(),opMap,StepperManager=function(){var b=[],c=null,d=null,e=null,f=Object.create(null);return{id:"Stepper",name:"Stepper",panel:null,manager:null,init:function(b){var g=this;this.panel.setAttribute("style","padding: 5px;"),d=document.createElement("div"),e=document.createElement("select"),e.addEventListener("change",function(a){g.selectStepper(this.value)}),d.appendChild(e),c=document.createElement("div"),this.panel.appendChild(d),this.panel.appendChild(c),sessionStorage.getItem("pdfjsBreakPoints")&&(f=JSON.parse(sessionStorage.getItem("pdfjsBreakPoints"))),opMap=Object.create(null);for(var h in b.OPS)opMap[b.OPS[h]]=h},cleanup:function(){e.textContent="",c.textContent="",b=[]},enabled:!1,active:!1,create:function(d){var g=document.createElement("div");g.id="stepper"+d,g.setAttribute("hidden",!0),g.className="stepper",c.appendChild(g);var h=document.createElement("option");h.textContent="Page "+(d+1),h.value=d,e.appendChild(h);var i=f[d]||[],j=new Stepper(g,d,i);return b.push(j),1===b.length&&this.selectStepper(d,!1),j},selectStepper:function(c,d){var f;for(c|=0,d&&this.manager.selectPanel(this),f=0;f<b.length;++f){var g=b[f];g.pageIndex===c?g.panel.removeAttribute("hidden"):g.panel.setAttribute("hidden",!0)}var h=e.options;for(f=0;f<h.length;++f){var i=h[f];i.selected=(0|i.value)===c}},saveBreakPoints:function(b,c){f[b]=c,sessionStorage.setItem("pdfjsBreakPoints",JSON.stringify(f))}}}(),Stepper=function(){function b(a,b){var c=document.createElement(a);return b&&(c.textContent=b),c}function c(a){if("string"==typeof a){var b=75;return a.length<=b?a:a.substr(0,b)+"..."}if("object"!=typeof a||null===a)return a;if("length"in a){var e,f,d=[],g=10;for(e=0,f=Math.min(g,a.length);e<f;e++)d.push(c(a[e]));return e<a.length&&d.push("..."),d}var h={};for(var i in a)h[i]=c(a[i]);return h}function d(a,b,c){this.panel=a,this.breakPoint=0,this.nextBreakPoint=null,this.pageIndex=b,this.breakPoints=c,this.currentIdx=-1,this.operatorListIdx=0}return d.prototype={init:function(c){var d=this.panel,e=b("div","c=continue, s=step"),f=b("table");e.appendChild(f),f.cellSpacing=0;var g=b("tr");f.appendChild(g),g.appendChild(b("th","Break")),g.appendChild(b("th","Idx")),g.appendChild(b("th","fn")),g.appendChild(b("th","args")),d.appendChild(e),this.table=f,this.updateOperatorList(c)},updateOperatorList:function(d){function f(){var a=+this.dataset.idx;this.checked?e.breakPoints.push(a):e.breakPoints.splice(e.breakPoints.indexOf(a),1),StepperManager.saveBreakPoints(e.pageIndex,e.breakPoints)}var e=this,g=15e3;if(!(this.operatorListIdx>g)){for(var h=document.createDocumentFragment(),i=Math.min(g,d.fnArray.length),j=this.operatorListIdx;j<i;j++){var k=b("tr");k.className="line",k.dataset.idx=j,h.appendChild(k);var l=-1!==this.breakPoints.indexOf(j),m=d.argsArray[j]||[],n=b("td"),o=b("input");o.type="checkbox",o.className="points",o.checked=l,o.dataset.idx=j,o.onclick=f,n.appendChild(o),k.appendChild(n),k.appendChild(b("td",j.toString()));var p=opMap[d.fnArray[j]],q=m;if("showText"===p){for(var r=m[0],s=[],t=[],u=0;u<r.length;u++){var v=r[u];"object"==typeof v&&null!==v?t.push(v.fontChar):(t.length>0&&(s.push(t.join("")),t=[]),s.push(v))}t.length>0&&s.push(t.join("")),q=[s]}k.appendChild(b("td",p)),k.appendChild(b("td",JSON.stringify(c(q))))}if(i<d.fnArray.length){k=b("tr");var w=b("td","...");w.colspan=4,h.appendChild(w)}this.operatorListIdx=d.fnArray.length,this.table.appendChild(h)}},getNextBreakPoint:function(){this.breakPoints.sort(function(a,b){return a-b});for(var b=0;b<this.breakPoints.length;b++)if(this.breakPoints[b]>this.currentIdx)return this.breakPoints[b];return null},breakIt:function(b,c){StepperManager.selectStepper(this.pageIndex,!0);var d=this,e=document;d.currentIdx=b;var f=function(a){switch(a.keyCode){case 83:e.removeEventListener("keydown",f),d.nextBreakPoint=d.currentIdx+1,d.goTo(-1),c();break;case 67:e.removeEventListener("keydown",f);var b=d.getNextBreakPoint();d.nextBreakPoint=b,d.goTo(-1),c()}};e.addEventListener("keydown",f),d.goTo(b)},goTo:function(b){for(var c=this.panel.getElementsByClassName("line"),d=0,e=c.length;d<e;++d){var f=c[d];(0|f.dataset.idx)===b?(f.style.backgroundColor="rgb(251,250,207)",f.scrollIntoView()):f.style.backgroundColor=null}}},d}(),Stats=function(){function c(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)}function d(a){for(var c=0,d=b.length;c<d;++c)if(b[c].pageNumber===a)return c;return!1}var b=[];return{id:"Stats",name:"Stats",panel:null,manager:null,init:function(b){this.panel.setAttribute("style","padding: 5px;"),b.PDFJS.enableStats=!0},enabled:!1,active:!1,add:function(a,e){if(e){var f=d(a);if(!1!==f){var g=b[f];this.panel.removeChild(g.div),b.splice(f,1)}var h=document.createElement("div");h.className="stats";var i=document.createElement("div");i.className="title",i.textContent="Page: "+a;var j=document.createElement("div");j.textContent=e.toString(),h.appendChild(i),h.appendChild(j),b.push({pageNumber:a,div:h}),b.sort(function(a,b){return a.pageNumber-b.pageNumber}),c(this.panel);for(var k=0,l=b.length;k<l;++k)this.panel.appendChild(b[k].div)}},cleanup:function(){b=[],c(this.panel)}}}(),PDFBug=function(){var c=[],d=null;return{tools:[FontInspector,StepperManager,Stats],enable:function(a){var b=!1,c=this.tools;1===a.length&&"all"===a[0]&&(b=!0);for(var d=0;d<c.length;++d){var e=c[d];(b||-1!==a.indexOf(e.id))&&(e.enabled=!0)}b||c.sort(function(b,d){var e=a.indexOf(b.id);e=e<0?c.length:e;var f=a.indexOf(d.id);return f=f<0?c.length:f,e-f})},init:function(d,e){var f=document.createElement("div");f.id="PDFBug";var g=document.createElement("div");g.setAttribute("class","controls"),f.appendChild(g);var h=document.createElement("div");h.setAttribute("class","panels"),f.appendChild(h),e.appendChild(f),e.style.right="300px";for(var i=this.tools,j=this,k=0;k<i.length;++k){var l=i[k],m=document.createElement("div"),n=document.createElement("button");n.textContent=l.name,n.addEventListener("click",function(a){return function(b){b.preventDefault(),j.selectPanel(a)}}(k)),g.appendChild(n),h.appendChild(m),l.panel=m,l.manager=this,l.enabled?l.init(d):m.textContent=l.name+' is disabled. To enable add  "'+l.id+'" to the pdfBug parameter and refresh (separate multiple by commas).',c.push(n)}this.selectPanel(0)},cleanup:function(){for(var b=0,c=this.tools.length;b<c;b++)this.tools[b].enabled&&this.tools[b].cleanup()},selectPanel:function(b){if("number"!=typeof b&&(b=this.tools.indexOf(b)),b!==d){d=b;for(var e=this.tools,f=0;f<e.length;++f)f===b?(c[f].setAttribute("class","active"),e[f].active=!0,e[f].panel.removeAttribute("hidden")):(c[f].setAttribute("class",""),e[f].active=!1,e[f].panel.setAttribute("hidden","true"))}}}}();